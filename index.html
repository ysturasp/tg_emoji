<!DOCTYPE html>
<html lang="ru" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Animated Emojis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .notification {
            transform: translateX(100%);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }
        .notification.hide {
            transform: translateX(100%);
            opacity: 0;
        }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            100: '#1a1a1a',
                            200: '#2d2d2d',
                            300: '#404040',
                            400: '#525252',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 dark:bg-dark-100 min-h-screen p-8 transition-colors duration-200">
    <div class="max-w-7xl mx-auto relative">
        <!-- Переключатель темы -->
        <div class="absolute top-0 right-0 p-4">
            <button id="theme-toggle" class="p-2 rounded-lg bg-white dark:bg-dark-200 text-gray-800 dark:text-white shadow-md hover:shadow-lg transition-all duration-200">
                <i class="fas fa-moon dark:hidden"></i>
                <i class="fas fa-sun hidden dark:block"></i>
            </button>
        </div>

        <h1 class="text-4xl font-bold text-center mb-8 text-gray-800 dark:text-white">Telegram Animated Emojis</h1>

        <!-- Поле поиска -->
        <div class="mb-8 max-w-md mx-auto">
            <div class="relative">
                <input type="text" id="search-input" 
                    class="w-full px-4 py-2 rounded-lg bg-white dark:bg-dark-200 text-gray-800 dark:text-white border border-gray-300 dark:border-dark-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200"
                    placeholder="Поиск эмодзи...">
                <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 dark:text-gray-500">
                    <i class="fas fa-search"></i>
                </span>
            </div>
        </div>
        
        <div class="mb-8 flex flex-wrap gap-4 justify-center" id="category-filters">
            <!-- Фильтры категорий будут добавлены через JavaScript -->
        </div>
        
        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4" id="emoji-container">
            <!-- Эмодзи будут добавлены через JavaScript -->
        </div>

        <!-- Уведомление о копировании -->
        <div id="copy-notification" class="fixed bottom-8 right-8 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg transform translate-y-[200%] transition-transform duration-300">
            Скопировано!
        </div>

        <!-- Временный элемент для копирования -->
        <textarea id="copy-textarea" style="position: fixed; top: -9999px; left: -9999px;"></textarea>
    </div>

    <script>
        // Инициализация темы
        const theme = localStorage.getItem('theme') || 'light';
        document.documentElement.className = theme;

        // Обработчик переключения темы
        document.getElementById('theme-toggle').addEventListener('click', () => {
            const html = document.documentElement;
            const newTheme = html.classList.contains('dark') ? 'light' : 'dark';
            html.className = newTheme;
            localStorage.setItem('theme', newTheme);
        });

        const categories = [
            'Activity',
            'Animals and Nature',
            'Flags',
            'Food and Drink',
            'Objects',
            'People',
            'Smileys',
            'Symbols',
            'Travel and Places'
        ];

        const categoryFilters = document.getElementById('category-filters');
        const emojiContainer = document.getElementById('emoji-container');
        const copyNotification = document.getElementById('copy-notification');
        const copyTextarea = document.getElementById('copy-textarea');
        const searchInput = document.getElementById('search-input');
        let currentCategory = null;
        let allEmojis = [];

        // Обновленный список эмодзи по категориям
        const emojiMap = {
            'Activity': [
                '1st Place Medal', '2nd Place Medal', '3rd Place Medal', 'Admission Tickets',
                'Artist Palette', 'Balloon', 'Basketball', 'Christmas Tree', 'Confetti Ball',
                'Crystal Ball', 'Firecracker', 'Fireworks', 'Jack O Lantern', 'Magic Wand',
                'Military Medal', 'Mirror Ball', 'Party Popper', 'Performing Arts',
                'Soccer Ball', 'Sparkler', 'Sparkles', 'Sports Medal', 'Ticket',
                'Trophy', 'Video Game'
            ],
            'Food and Drink': [
                'Baby Bottle', 'Banana', 'Bento Box', 'Beverage Box', 'Birthday Cake',
                'Bottle With Popping Cork', 'Bubble Tea', 'Canned Food', 'Chocolate Bar',
                'Clinking Glasses', 'Cocktail Glass', 'Cookie', 'Cooking', 'Cup With Straw',
                'Cupcake', 'Custard', 'Dango', 'Doughnut', 'Fish Cake With Swirl',
                'Fork And Knife With Plate', 'French Fries', 'Glass Of Milk', 'Hamburger',
                'Hot Beverage', 'Hot Dog', 'Lollipop', 'Mate', 'Meat On Bone', 'Oden',
                'Pancakes', 'Pie', 'Pizza', 'Popcorn', 'Poultry Leg', 'Pouring Liquid',
                'Pretzel', 'Rice Ball', 'Rice Cracker', 'Sandwich', 'Shortcake',
                'Soft Ice Cream', 'Strawberry', 'Stuffed Flatbread', 'Sushi', 'Taco',
                'Tropical Drink', 'Tumbler Glass', 'Wine Glass'
            ],
            'Flags': [
                'Black Flag', 'Chequered Flag', 'Flag Argentina', 'Flag Armenia',
                'Flag Austria', 'Flag Bahamas', 'Flag Belarus', 'Flag Belgium',
                'Flag Benin', 'Flag Brazil', 'Flag Bulgaria', 'Flag Burkina Faso',
                'Flag Cameroon', 'Flag Chad', 'Flag China', 'Flag Cote Divoire',
                'Flag Croatia', 'Flag Czechia', 'Flag Djibouti', 'Flag Equatorial Guinea',
                'Flag Estonia', 'Flag France', 'Flag Gabon', 'Flag Germany', 'Flag Ghana',
                'Flag Guinea Bissau', 'Flag Guinea', 'Flag Hungary', 'Flag India',
                'Flag Indonesia', 'Flag Ireland', 'Flag Italy', 'Flag Japan', 'Flag Jordan',
                'Flag Lithuania', 'Flag Luxembourg', 'Flag Madagascar', 'Flag Mali',
                'Flag Monaco', 'Flag Morocco', 'Flag Mozambique', 'Flag Myanmar Burma',
                'Flag Netherlands', 'Flag Nigeria', 'Flag Palestinian Territories',
                'Flag Peru', 'Flag Philippines', 'Flag Poland', 'Flag Romania',
                'Flag Russia', 'Flag Sao Tome Principe', 'Flag Saudi Arabia',
                'Flag Senegal', 'Flag Sierra Leone', 'Flag Singapore', 'Flag Sint Maarten',
                'Flag Somalia', 'Flag South Korea', 'Flag South Sudan', 'Flag Spain',
                'Flag Sudan', 'Flag Ukraine', 'Flag United Arab Emirates',
                'Flag United Kingdom', 'Flag United States', 'Flag Uzbekistan',
                'Flag Vietnam', 'Flag Western Sahara', 'Flag Yemen', 'Pirate Flag',
                'Triangular Flag', 'White Flag'
            ],
            'Objects': [
                'Abacus', 'Ballot Box With Ballot', 'Bar Chart', 'Bomb', 'Books',
                'Briefcase', 'Card Index Dividers', 'Chart Decreasing', 'Chart Increasing',
                'Clapper Board', 'Coffin', 'Coin', 'Crown', 'File Folder', 'Gem Stone',
                'Graduation Cap', 'Handbag', 'High Heeled Shoe', 'Hourglass Done',
                'Hourglass Not Done', 'Identification Card', 'Inbox Tray',
                'Incoming Envelope', 'Key', 'Keyboard', 'Laptop', 'Light Bulb',
                'Locked With Key', 'Luggage', 'Magnifying Glass Tilted Left',
                'Magnifying Glass Tilted Right', 'Megaphone', 'Memo', 'Microphone',
                'Microscope', 'Military Helmet', 'Mobile Phone With Arrow', 'Mobile Phone',
                'Money Bag', 'Money With Wings', 'Musical Note', 'Musical Notes',
                'Newspaper', 'Old Key', 'Open Book', 'Outbox Tray', 'Pencil', 'Pill',
                'Printer', 'Purse', 'Reminder Ribbon', 'Roll Of Paper', 'Shopping Bags',
                'Shopping Cart', 'Soap', 'Sponge', 'Stethoscope', 'Studio Microphone',
                'Syringe', 'Tear Off Calendar', 'Telephone Receiver', 'Telephone',
                'Telescope', 'Television', 'Test Tube', 'Thermometer', 'Toolbox',
                'Top Hat'
            ],
            'Animals and Nature': [
                'Ant', 'Baby Chick', 'Bat', 'Bear', 'Beetle', 'Bird', 'Bison',
                'Black Cat', 'Blossom', 'Bouquet', 'Bug', 'Butterfly', 'Cactus',
                'Cat Face', 'Cat', 'Cherry Blossom', 'Chicken',
                'Cloud With Lightning And Rain', 'Cloud With Lightning',
                'Cloud With Rain', 'Cloud With Snow', 'Cloud', 'Cockroach',
                'Cow', 'Cricket', 'Deciduous Tree', 'Deer', 'Dog Face', 'Dove',
                'Duck', 'Evergreen Tree', 'Fire', 'First Quarter Moon Face',
                'First Quarter Moon', 'Fish', 'Flamingo', 'Four Leaf Clover',
                'Fox', 'Frog', 'Front Facing Baby Chick', 'Full Moon Face',
                'Full Moon', 'Giraffe', 'Glowing Star', 'Gorilla', 'Hamster',
                'Hatching Chick', 'Hedgehog', 'Herb', 'Hibiscus', 'High Voltage',
                'Honeybee', 'Horse Face', 'Horse', 'Kangaroo', 'Koala',
                'Lady Beetle', 'Last Quarter Moon Face', 'Last Quarter Moon',
                'Leopard', 'Lion', 'Llama', 'Lobster', 'Microbe', 'Monkey Face',
                'Mosquito', 'Mouse Face', 'New Moon Face', 'New Moon', 'Octopus',
                'Owl', 'Ox', 'Palm Tree', 'Panda', 'Parrot', 'Paw Prints',
                'Penguin', 'Pig Face', 'Pig Nose', 'Polar Bear', 'Rabbit Face',
                'Rabbit', 'Raccoon', 'Rainbow', 'Rose', 'Rosette', 'Sauropod',
                'Seal', 'Seedling', 'Shamrock', 'Shrimp', 'Snail', 'Snake',
                'Snowflake', 'Snowman Without Snow', 'Snowman', 'Spider Web',
                'Spider', 'Spouting Whale', 'Squid'
            ],
            'People': [
                'Baby', 'Backhand Index Pointing Down', 'Backhand Index Pointing Left',
                'Backhand Index Pointing Right', 'Backhand Index Pointing Up',
                'Biting Lip', 'Bone', 'Bust In Silhouette', 'Busts In Silhouette',
                'Call Me Hand', 'Clapping Hands', 'Crossed Fingers',
                'Ear With Hearing Aid', 'Ear', 'Eyes', 'Family Man Woman Girl Boy',
                'Flexed Biceps', 'Folded Hands', 'Foot', 'Footprints',
                'Hand With Fingers Splayed', 'Hand With Index Finger And Thumb Crossed',
                'Handshake', 'Heart Hands', 'Index Pointing At The Viewer',
                'Index Pointing Up', 'Left Facing Fist', 'Leftwards Hand', 'Leg',
                'Love You Gesture', 'Man Dancing', 'Man Facepalming',
                'Man Health Worker', 'Man Police Officer', 'Man Shrugging',
                'Man Teacher', 'Man Technologist', 'Man Vampire', 'Man Zombie',
                'Mechanical Arm', 'Mechanical Leg', 'Middle Finger', 'Mouth',
                'Mrs Claus', 'Mx Claus', 'Nail Polish', 'Nose', 'Ok Hand',
                'Old Woman', 'Oncoming Fist', 'Open Hands', 'Palm Down Hand',
                'Palm Up Hand', 'Palms Up Together', 'People Hugging',
                'Person Facepalming', 'Person Shrugging', 'Pinched Fingers',
                'Pinching Hand', 'Pregnant Woman', 'Raised Back Of Hand',
                'Raised Fist', 'Raised Hand', 'Raising Hands', 'Right Facing Fist',
                'Rightwards Hand', 'Santa Claus', 'Sign Of The Horns',
                'Speaking Head', 'Technologist', 'Thumbs Down', 'Thumbs Up',
                'Tongue', 'Tooth', 'Vampire', 'Victory Hand', 'Vulcan Salute',
                'Waving Hand', 'Woman Dancing', 'Woman Facepalming',
                'Woman Health Worker', 'Woman Police Officer', 'Woman Shrugging',
                'Woman Technologist', 'Woman Vampire', 'Woman Zombie',
                'Writing Hand', 'Zombie'
            ],
            'Smileys': [
                'Alien Monster', 'Alien', 'Angry Face With Horns', 'Angry Face',
                'Anguished Face', 'Anxious Face With Sweat', 'Astonished Face',
                'Beaming Face With Smiling Eyes', 'Cat With Tears Of Joy',
                'Cat With Wry Smile', 'Clown Face', 'Cold Face', 'Confounded Face',
                'Confused Face', 'Cowboy Hat Face', 'Crying Cat', 'Crying Face',
                'Disappointed Face', 'Disguised Face', 'Dizzy Face',
                'Dotted Line Face', 'Downcast Face With Sweat', 'Drooling Face',
                'Exploding Head', 'Expressionless Face', 'Face Blowing A Kiss',
                'Face Exhaling', 'Face Holding Back Tears', 'Face In Clouds',
                'Face Savoring Food', 'Face Screaming In Fear', 'Face Vomiting',
                'Face With Diagonal Mouth', 'Face With Hand Over Mouth',
                'Face With Head Bandage', 'Face With Medical Mask',
                'Face With Monocle', 'Face With Open Eyes And Hand Over Mouth',
                'Face With Open Mouth', 'Face With Peeking Eye',
                'Face With Raised Eyebrow', 'Face With Rolling Eyes',
                'Face With Spiral Eyes', 'Face With Steam From Nose',
                'Face With Symbols On Mouth', 'Face With Tears Of Joy',
                'Face With Thermometer', 'Face With Tongue', 'Face Without Mouth',
                'Fearful Face', 'Flushed Face', 'Frowning Face With Open Mouth',
                'Frowning Face', 'Ghost', 'Goblin', 'Grimacing Face',
                'Grinning Cat With Smiling Eyes', 'Grinning Cat',
                'Grinning Face With Big Eyes', 'Grinning Face With Smiling Eyes',
                'Grinning Face With Sweat', 'Grinning Face',
                'Grinning Squinting Face', 'Hear No Evil Monkey', 'Hot Face',
                'Hugging Face', 'Hushed Face', 'Kissing Cat',
                'Kissing Face With Closed Eyes', 'Kissing Face',
                'Loudly Crying Face', 'Lying Face', 'Melting Face',
                'Money Mouth Face', 'Nauseated Face', 'Nerd Face', 'Neutral Face',
                'Ogre', 'Partying Face', 'Pensive Face', 'Persevering Face',
                'Pile Of Poo', 'Pleading Face', 'Pouting Cat', 'Pouting Face',
                'Relieved Face', 'Robot', 'Rolling On The Floor Laughing',
                'Sad But Relieved Face', 'Saluting Face', 'See No Evil Monkey',
                'Shushing Face', 'Skull And Crossbones', 'Skull', 'Sleeping Face',
                'Sleepy Face', 'Slightly Frowning Face', 'Slightly Smiling Face',
                'Smiling Cat With Heart Eyes', 'Smiling Face With Halo'
            ],
            'Symbols': [
                'Anger Symbol', 'Aquarius', 'Aries', 'Baby Symbol',
                'Baggage Claim', 'Beating Heart', 'Black Heart', 'Blue Heart',
                'Broken Heart', 'Brown Heart', 'Cancer', 'Capricorn',
                'Check Box With Check', 'Check Mark Button', 'Check Mark',
                'Collision', 'Cool Button', 'Cross Mark', 'Currency Exchange',
                'Customs', 'Dizzy', 'Double Exclamation Mark', 'Exclamation Mark',
                'Exclamation Question Mark', 'Free Button', 'Gemini',
                'Green Heart', 'Growing Heart', 'Heart Decoration',
                'Heart Exclamation', 'Heart On Fire', 'Heart With Arrow',
                'Heart With Ribbon', 'Hundred Points', 'Kiss Mark',
                'Left Luggage', 'Leo', 'Libra', 'Love Letter', 'Mending Heart',
                'Mens Room', 'New Button', 'No One Under Eighteen', 'Ok Button',
                'Ophiuchus', 'Orange Heart', 'Passport Control', 'Pisces',
                'Purple Heart', 'Question Mark', 'Red Heart', 'Revolving Hearts',
                'Right Anger Bubble', 'Sagittarius', 'Scorpio', 'Sparkling Heart',
                'Speech Balloon', 'Taurus', 'Thought Balloon', 'Top Arrow',
                'Two Hearts', 'Up Button', 'Virgo', 'White Exclamation Mark',
                'White Heart', 'White Question Mark', 'Womens Room',
                'Yellow Heart', 'Zzz'
            ],
            'Travel and Places': [
                'Airplane', 'Ambulance', 'Automobile', 'Beach With Umbrella',
                'Camping', 'Classical Building', 'Compass', 'Desert Island',
                'Hot Springs', 'House', 'Locomotive', 'Moai', 'Motor Boat',
                'Police Car', 'Rocket', 'Roller Coaster', 'Taxi'
            ]
        };

        // Функция для форматирования имени файла для URL
        function formatEmojiFileName(name) {
            // Оставляем пробелы как есть, удаляем только специальные символы
            return name.replace(/[&\/\\#,+()$~%.'":*?<>{}]/g, '');
        }

        // Функция для форматирования имени для отображения
        function formatEmojiDisplayName(name) {
            return decodeURIComponent(name)
                .replace(/%20/g, ' ')
                .replace(/([A-Z])/g, ' $1')
                .trim();
        }

        // Обновленная функция показа уведомления
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed bottom-5 right-5 left-5 sm:right-10 sm:left-auto bg-green-500 text-white py-2 px-4 rounded-lg z-50 notification';
            notification.textContent = message;

            document.body.appendChild(notification);

            notification.addEventListener('touchmove', (e) => {
                e.preventDefault();
            });

            let touchStartX = 0;
            let currentX = 0;
            let moveX = 0;
            let isSwiping = false;

            notification.addEventListener('touchstart', (e) => {
                touchStartX = e.changedTouches[0].screenX;
                isSwiping = true;
                notification.style.transition = '';
            });

            notification.addEventListener('touchmove', (e) => {
                if (!isSwiping) return;

                currentX = e.changedTouches[0].screenX;
                moveX = currentX - touchStartX;

                notification.style.transform = `translateX(${moveX}px)`;
            });

            notification.addEventListener('touchend', () => {
                if (!isSwiping) return;

                isSwiping = false;
                if (Math.abs(moveX) > 100) {
                    const direction = moveX < 0 ? '-110%' : '110%';
                    notification.style.transition = 'transform 0.5s ease';
                    notification.style.transform = `translateX(${direction})`;

                    setTimeout(() => {
                        notification.remove();
                    }, 500);
                } else {
                    notification.style.transition = 'transform 0.3s ease';
                    notification.style.transform = 'translateX(0)';
                }
            });

            notification.addEventListener('click', () => {
                notification.style.transition = 'transform 0.5s ease, opacity 0.5s ease';
                notification.style.transform = 'translateX(100%)';
                notification.style.opacity = '0';

                setTimeout(() => {
                    notification.remove();
                }, 500);
            });

            setTimeout(() => {
                notification.classList.add('show');
            }, 10);

            setTimeout(() => {
                notification.classList.remove('show');
                notification.classList.add('hide');

                setTimeout(() => {
                    notification.remove();
                }, 500);
            }, 5000);
        }

        // Функция для копирования изображения
        async function copyImage(imgElement) {
            try {
                const absoluteUrl = new URL(imgElement.src, window.location.href).href;
                const imgTag = `<img src="${absoluteUrl}" alt="${imgElement.alt}" />`;
                
                copyTextarea.value = imgTag;
                copyTextarea.select();
                const success = document.execCommand('copy');
                
                if (success) {
                    showNotification('HTML-тег скопирован!');
                } else {
                    await navigator.clipboard.writeText(imgTag);
                    showNotification('HTML-тег скопирован!');
                }
            } catch (err) {
                console.error('Error copying image tag:', err);
                showNotification('Ошибка при копировании');
            }
        }

        // Функция создания карточки эмодзи
        function createEmojiCard(emojiName, category) {
            const card = document.createElement('div');
            card.className = 'bg-white dark:bg-dark-200 rounded-lg p-4 shadow-md hover:shadow-lg transition-all duration-300 flex flex-col items-center relative group';
            
            const img = document.createElement('img');
            const formattedName = formatEmojiFileName(emojiName);
            const imgUrl = `${category}/${formattedName}.webp`;
            img.src = imgUrl;
            img.alt = formatEmojiDisplayName(emojiName);
            img.className = 'w-16 h-16 object-contain';
            img.crossOrigin = 'anonymous';
            
            // Добавляем обработчик ошибки загрузки изображения с подробным логированием
            img.onerror = () => {
                console.error(`Failed to load emoji: ${imgUrl}`);
                console.log('Category:', category);
                console.log('Original name:', emojiName);
                console.log('Formatted name:', formattedName);
                card.classList.add('opacity-50');
                card.title = `Ошибка загрузки: ${emojiName}`;
                
                // Добавляем текст ошибки под изображением
                const errorText = document.createElement('p');
                errorText.className = 'text-xs text-red-500 mt-1';
                errorText.textContent = 'Ошибка загрузки';
                card.appendChild(errorText);
            };
            
            const name = document.createElement('p');
            name.className = 'mt-2 text-sm text-gray-600 dark:text-gray-300 text-center';
            name.textContent = formatEmojiDisplayName(emojiName);

            const buttonsContainer = document.createElement('div');
            buttonsContainer.className = 'absolute top-2 right-2 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300';

            const copyButton = document.createElement('button');
            copyButton.className = 'bg-blue-500 text-white p-1 rounded hover:bg-blue-600 transition-colors';
            copyButton.innerHTML = '<i class="fas fa-copy"></i>';
            copyButton.onclick = (e) => {
                e.stopPropagation();
                copyImage(img);
            };

            const downloadButton = document.createElement('button');
            downloadButton.className = 'bg-green-500 text-white p-1 rounded hover:bg-green-600 transition-colors';
            downloadButton.innerHTML = '<i class="fas fa-download"></i>';
            downloadButton.onclick = (e) => {
                e.stopPropagation();
                const link = document.createElement('a');
                link.href = img.src;
                link.download = `${formatEmojiDisplayName(emojiName)}.webp`;
                link.click();
            };

            buttonsContainer.appendChild(copyButton);
            buttonsContainer.appendChild(downloadButton);
            
            card.appendChild(img);
            card.appendChild(name);
            card.appendChild(buttonsContainer);
            return card;
        }

        // Функция фильтрации эмодзи
        function filterEmojis(searchTerm) {
            const normalizedSearch = searchTerm.toLowerCase();
            const filteredEmojis = allEmojis.filter(emoji => 
                formatEmojiDisplayName(emoji.name).toLowerCase().includes(normalizedSearch)
            );

            emojiContainer.innerHTML = '';
            if (filteredEmojis.length === 0) {
                emojiContainer.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center col-span-full">Ничего не найдено</p>';
                return;
            }

            filteredEmojis.forEach(emoji => {
                emojiContainer.appendChild(createEmojiCard(emoji.name, emoji.category));
            });
        }

        // Обновленная функция загрузки всех категорий
        async function loadAllCategories() {
            const loadingMessage = document.createElement('p');
            loadingMessage.className = 'text-gray-500 dark:text-gray-400 text-center col-span-full';
            loadingMessage.textContent = 'Загрузка всех эмодзи...';
            emojiContainer.innerHTML = '';
            emojiContainer.appendChild(loadingMessage);

            try {
                Object.entries(emojiMap).forEach(([category, emojis]) => {
                    emojis.forEach(name => {
                        if (!allEmojis.some(e => e.name === name && e.category === category)) {
                            allEmojis.push({ name, category });
                        }
                    });
                });
                return true;
            } catch (error) {
                console.error('Error loading all categories:', error);
                return false;
            }
        }

        let isAllCategoriesLoaded = false;

        // Обновленный обработчик поиска
        searchInput.addEventListener('input', async (e) => {
            const searchTerm = e.target.value.trim();
            
            if (searchTerm === '') {
                // Сбрасываем результаты поиска и возвращаем текущую категорию
                if (currentCategory) {
                    // Обновляем стили кнопок категорий
                    document.querySelectorAll('#category-filters button').forEach(btn => {
                        if (btn.textContent === currentCategory) {
                            btn.classList.remove('bg-white', 'dark:bg-dark-200', 'text-gray-700', 'dark:text-white');
                            btn.classList.add('bg-blue-500', 'text-white');
                        } else {
                            btn.classList.remove('bg-blue-500', 'text-white');
                            btn.classList.add('bg-white', 'dark:bg-dark-200', 'text-gray-700', 'dark:text-white');
                        }
                    });
                    
                    // Очищаем контейнер и показываем эмодзи текущей категории
                    emojiContainer.innerHTML = '';
                    const categoryEmojis = allEmojis.filter(emoji => emoji.category === currentCategory);
                    categoryEmojis.forEach(emoji => {
                        emojiContainer.appendChild(createEmojiCard(emoji.name, emoji.category));
                    });
                } else {
                    // Если категория не выбрана, загружаем первую категорию
                    loadEmojisForCategory(categories[0]);
                }
                return;
            }

            // Если это первый поиск, загружаем все категории
            if (!isAllCategoriesLoaded) {
                isAllCategoriesLoaded = await loadAllCategories();
                if (!isAllCategoriesLoaded) {
                    emojiContainer.innerHTML = '<p class="text-red-500 dark:text-red-400 text-center col-span-full">Ошибка загрузки эмодзи</p>';
                    return;
                }
            }

            // Сбрасываем выделение категории при поиске
            document.querySelectorAll('#category-filters button').forEach(btn => {
                btn.classList.remove('bg-blue-500', 'text-white');
                btn.classList.add('bg-white', 'dark:bg-dark-200', 'text-gray-700', 'dark:text-white');
            });

            filterEmojis(searchTerm);
        });

        // Создаем фильтры категорий
        categories.forEach(category => {
            const button = document.createElement('button');
            button.className = 'px-4 py-2 rounded-full bg-white dark:bg-dark-200 shadow-md hover:shadow-lg transition-all duration-300 text-gray-700 dark:text-white hover:bg-blue-500 hover:text-white dark:hover:bg-blue-600';
            button.textContent = category;
            button.onclick = () => {
                searchInput.value = '';
                loadEmojisForCategory(category);
            };
            categoryFilters.appendChild(button);
        });

        // Обновленная функция загрузки категории
        async function loadEmojisForCategory(category) {
            if (currentCategory === category && searchInput.value.trim() === '') return;
            currentCategory = category;
            
            // Обновляем стили кнопок
            document.querySelectorAll('#category-filters button').forEach(btn => {
                if (btn.textContent === category) {
                    btn.classList.remove('bg-white', 'dark:bg-dark-200', 'text-gray-700', 'dark:text-white');
                    btn.classList.add('bg-blue-500', 'text-white');
                } else {
                    btn.classList.remove('bg-blue-500', 'text-white');
                    btn.classList.add('bg-white', 'dark:bg-dark-200', 'text-gray-700', 'dark:text-white');
                }
            });

            try {
                emojiContainer.innerHTML = '';
                const emojis = emojiMap[category] || [];

                // Добавляем эмодзи в общий список
                emojis.forEach(name => {
                    if (!allEmojis.some(e => e.name === name && e.category === category)) {
                        allEmojis.push({ name, category });
                    }
                });

                emojis.forEach(emojiName => {
                    emojiContainer.appendChild(createEmojiCard(emojiName, category));
                });
            } catch (error) {
                console.error('Error loading category:', error);
                emojiContainer.innerHTML = '<p class="text-red-500 dark:text-red-400 text-center col-span-full">Ошибка загрузки категории</p>';
            }
        }

        // Загружаем первую категорию по умолчанию
        loadEmojisForCategory(categories[0]);
    </script>
</body>
</html> 